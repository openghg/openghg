<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Packaging releases &mdash; OpenGHG 0+untagged.3.gebdf2e0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="_static/custom.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="_static/openghg_logo_v1.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation instructions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials/index.html">Tutorials</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="development/index_devel.html">Development</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/index_devapi.html">Developer API documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OpenGHG</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Packaging releases</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="packaging-releases">
<h1>Packaging releases<a class="headerlink" href="#packaging-releases" title="Permalink to this headline"></a></h1>
<p>Pack and Doc is now fully tested and deployed using GitHub actions.
The development process should be;</p>
<ul class="simple">
<li><p>New features are developed on feature branches, called <code class="docutils literal notranslate"><span class="pre">feature-{feature}</span></code>,
either in the <a class="reference external" href="https://github.com/openghg/openghg">main Pack and Doc repository</a>
for authorised developers, or in personal forks for
new developers.</p></li>
<li><p>Bug fixes or issue fixes are developed on fix branches, called
<code class="docutils literal notranslate"><span class="pre">fix-issue-{number}</span></code> (again in either the main repository or forks).</p></li>
<li><p>Pull requests are issued from these branches to <code class="docutils literal notranslate"><span class="pre">devel</span></code>. All merge conflicts
must be fixed in the branch and all tests must pass before the pull
request can be merged into <code class="docutils literal notranslate"><span class="pre">devel</span></code>.</p></li>
</ul>
<p>The result of this is that “devel” should contain the fully-working and
tested, and most up-to-date version of <code class="docutils literal notranslate"><span class="pre">pack</span> <span class="pre">and</span> <span class="pre">doc</span></code>. However, this
version should not be used for production runs.</p>
<section id="defining-a-release">
<h2>Defining a release<a class="headerlink" href="#defining-a-release" title="Permalink to this headline"></a></h2>
<p>We will release <code class="docutils literal notranslate"><span class="pre">pack</span> <span class="pre">and</span> <span class="pre">doc</span></code> regularly. Releases aim to be backwards
compatible and capable of being used for production runs, at least for
the functionality that is fully described in the tutorial.</p>
<p>We use <a class="reference external" href="https://semver.org">semantic versioning</a> and take care
not to cause breaking changes in the public API.</p>
</section>
<section id="creating-a-release">
<h2>Creating a release<a class="headerlink" href="#creating-a-release" title="Permalink to this headline"></a></h2>
<p>To create a release first checkout the “main” branch.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git checkout main
git pull
</pre></div>
</div>
<p>Next, merge in all changes from the “devel” branch.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git pull origin devel
</pre></div>
</div>
<p>Next, update the <a class="reference internal" href="changelog.html"><span class="doc">Changelog</span></a> with details about this release. This
should include the link at the top of the release that shows the commit
differences between versions. This can be easily copied from a previous
release and updated, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`0.11.2 &lt;https://github.com/metawards/MetaWards/compare/0.11.1...0.11.2&gt;`__ - May 11th 2020
</pre></div>
</div>
<p>could be changed to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`0.12.0 &lt;https://github.com/metawards/MetaWards/compare/0.11.2...0.12.0&gt;`__ - May 18th 2020
</pre></div>
</div>
<p>when moving from the 0.11.2 to 0.12.0 release.</p>
<p>Now push this change back to GitHub, using;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git push
</pre></div>
</div>
<p>This will trigger a CI/CD run which will build and test everything on
Windows, Mac and Linux for Python 3.7 and 3.8. Everything should work,
as “devel” should have been in a release-ready state.</p>
</section>
<section id="testing-the-packages">
<h2>Testing the packages<a class="headerlink" href="#testing-the-packages" title="Permalink to this headline"></a></h2>
<p><a class="reference external" href="https://github.com/metawards/MetaWards/actions">GitHub actions</a> will
produce the source and binary wheels for <code class="docutils literal notranslate"><span class="pre">metawards</span></code> on all supported
platforms. This will be in an artifact called <code class="docutils literal notranslate"><span class="pre">dist</span></code> which you should
download and unpack.</p>
<img alt="Image of the GitHub Actions interface showing the dist artifact" src="images/github_artifacts.jpg" />
<p>You should unpack these into the <code class="docutils literal notranslate"><span class="pre">dist</span></code> directory, e.g.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> dist
unzip ~/Downloads/dist.zip
</pre></div>
</div>
<p>This should result in six binary wheels and once source package, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">metawards</span><span class="o">-</span><span class="mf">0.11.1</span><span class="o">+</span><span class="mf">7.</span><span class="n">g52b3671</span><span class="o">-</span><span class="n">cp37</span><span class="o">-</span><span class="n">cp37m</span><span class="o">-</span><span class="n">macosx_10_14_x86_64</span><span class="o">.</span><span class="n">whl</span>
<span class="n">metawards</span><span class="o">-</span><span class="mf">0.11.1</span><span class="o">+</span><span class="mf">7.</span><span class="n">g52b3671</span><span class="o">-</span><span class="n">cp37</span><span class="o">-</span><span class="n">cp37m</span><span class="o">-</span><span class="n">manylinux1_x86_64</span><span class="o">.</span><span class="n">whl</span>
<span class="n">metawards</span><span class="o">-</span><span class="mf">0.11.1</span><span class="o">+</span><span class="mf">7.</span><span class="n">g52b3671</span><span class="o">-</span><span class="n">cp37</span><span class="o">-</span><span class="n">cp37m</span><span class="o">-</span><span class="n">win_amd64</span><span class="o">.</span><span class="n">whl</span>
<span class="n">metawards</span><span class="o">-</span><span class="mf">0.11.1</span><span class="o">+</span><span class="mf">7.</span><span class="n">g52b3671</span><span class="o">-</span><span class="n">cp38</span><span class="o">-</span><span class="n">cp38</span><span class="o">-</span><span class="n">macosx_10_14_x86_64</span><span class="o">.</span><span class="n">whl</span>
<span class="n">metawards</span><span class="o">-</span><span class="mf">0.11.1</span><span class="o">+</span><span class="mf">7.</span><span class="n">g52b3671</span><span class="o">-</span><span class="n">cp38</span><span class="o">-</span><span class="n">cp38</span><span class="o">-</span><span class="n">manylinux1_x86_64</span><span class="o">.</span><span class="n">whl</span>
<span class="n">metawards</span><span class="o">-</span><span class="mf">0.11.1</span><span class="o">+</span><span class="mf">7.</span><span class="n">g52b3671</span><span class="o">-</span><span class="n">cp38</span><span class="o">-</span><span class="n">cp38</span><span class="o">-</span><span class="n">win_amd64</span><span class="o">.</span><span class="n">whl</span>
<span class="n">metawards</span><span class="o">-</span><span class="mf">0.11.1</span><span class="o">+</span><span class="mf">7.</span><span class="n">g52b3671</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<p>Try to install the package related to you machine, just to double-check
that it is working, e.g.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install ./metawards-0.11.1+7.g52b3671-cp37-cp37m-macosx_10_14_x86_64.whl
<span class="nb">cd</span> ..
pytest tests
</pre></div>
</div>
<p>Once it is working, remove these temporary packages from your <code class="docutils literal notranslate"><span class="pre">dist</span></code> folder,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rm dist/*
</pre></div>
</div>
</section>
<section id="tagging-a-new-release">
<h2>Tagging a new release<a class="headerlink" href="#tagging-a-new-release" title="Permalink to this headline"></a></h2>
<p>Now that you are happy that the release is ready, you can tag the new
version. Do this using the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">tag</span></code> command, e.g.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git tag -a <span class="o">{</span>VERSION<span class="o">}</span> -m <span class="s2">&quot;{VERSION} release&quot;</span>
</pre></div>
</div>
<p>replacing <code class="docutils literal notranslate"><span class="pre">{VERSION}</span></code> with the version number. For this 0.12.0 release
the command would be;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git tag -a <span class="m">0</span>.12.0 -m <span class="s2">&quot;0.12.0 release&quot;</span>
</pre></div>
</div>
<p>Next, push your tag to GitHub;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git push --tags
</pre></div>
</div>
<p>The tag will be used by automatic versioning script to generate
the version numbers of the code. Building the package
(as happens below) will automatically update the _version.py
that is included in the package to tag versions.</p>
<p>This will also trigger a full CI/CD to test and build the new version.
Again, it should work as this tag was taken from your fully-tested
“main” branch.</p>
</section>
<section id="uploading-packages-to-pypi">
<h2>Uploading packages to pypi<a class="headerlink" href="#uploading-packages-to-pypi" title="Permalink to this headline"></a></h2>
<p>While you are waiting for the CI/CD GitHub Actions to complete, make sure
that your version of twine is fully up to date;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install --upgrade twine
</pre></div>
</div>
<p>Once GitHub actions is complete, you will see that another build artifact
is ready for download. Download this and unpack it into your <code class="docutils literal notranslate"><span class="pre">dist</span></code>
directory as before. You should now have a <code class="docutils literal notranslate"><span class="pre">dist</span></code> directory that
contains six binary wheels and one source package, named according to
the release version. For example, for the 0.11.2 release we had;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ls dist
 metawards-0.11.2-cp37-cp37m-macosx_10_14_x86_64.whl
 metawards-0.11.2-cp37-cp37m-manylinux1_x86_64.whl
 metawards-0.11.2-cp37-cp37m-win_amd64.whl
 metawards-0.11.2-cp38-cp38-macosx_10_14_x86_64.whl
 metawards-0.11.2-cp38-cp38-manylinux1_x86_64.whl
 metawards-0.11.2-cp38-cp38-win_amd64.whl
 metawards-0.11.2.tar.gz
</pre></div>
</div>
<p>Now you can upload to pypi using the command;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 -m twine upload dist/*
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You will need a username and password for pypi and to have
permission to upload code to this project. Currently only
the release manager has permission. If you would like
join the release management team then please get in touch.</p>
</div>
</section>
<section id="testing-the-final-release">
<h2>Testing the final release<a class="headerlink" href="#testing-the-final-release" title="Permalink to this headline"></a></h2>
<p>Finally(!) test the release on a range of different machines by logging
in and typing;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install <span class="nv">metawards</span><span class="o">=={</span>VERSION<span class="o">}</span>
</pre></div>
</div>
<p>replacing <code class="docutils literal notranslate"><span class="pre">{VERSION}</span></code> with the version number, e.g. for 0.11.2</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install <span class="nv">metawards</span><span class="o">==</span><span class="m">0</span>.11.2
</pre></div>
</div>
<p>Play with the code, run the tests and run some examples. Everything should
work as you have performed lots of prior testing to get to this stage.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020 OpenGHG development team.
      <span class="lastupdated">Last updated on Sep 20, 2021.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>