
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Workflow 3: comparing observations to emissions &#8212; OpenGHG 0+untagged.1.g60f3fb1 documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/custom.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Workflow 4: Working with carbon dioxide" href="4_Working_with_co2.html" />
    <link rel="prev" title="Workflow 2: handling overlapping observation data" href="2_Ranking_for_observations.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    <p class="title logo__title">OpenGHG 0+untagged.1.g60f3fb1 documentation</p>
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../features.html">
  Features
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../install.html">
  Installation instructions
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../development/index_devel.html">
  Development
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api/index.html">
  User API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api/index_devapi.html">
  Developer API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../whatsnew/index.html">
  Whatâ€™s new
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../cloud/index.html">
   Tutorials - Cloud
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../cloud/1_Ranking_for_observations.html">
     Workflow 1: handling overlapping observation data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cloud/2_Comparing_with_emissions.html">
     Workflow 2: comparing observations to emissions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cloud/3_Working_with_co2.html">
     Workflow 3: Working with carbon dioxide
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cloud/4_Searching_and_plotting.html">
     Workflow 4: Searching and plotting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cloud/5_Explore_NOAA_ObsPack.html">
     Workflow 5: Explore NOAA ObsPack
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cloud/6_Retrieving_remote_data.html">
     Workflow 6: Retrieving data from remote archives
    </a>
   </li>
  </ul>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Tutorials - Local
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="1_Adding_observation_data.html">
     Workflow 1: processing, searching and retrieving observations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2_Ranking_for_observations.html">
     Workflow 2: handling overlapping observation data
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Workflow 3: comparing observations to emissions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="4_Working_with_co2.html">
     Workflow 4: Working with carbon dioxide
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="5_Searching_and_plotting.html">
     Workflow 5: Searching and plotting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="6_Explore_NOAA_ObsPack.html">
     Workflow 6: Explore NOAA ObsPack
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="7_Retrieving_remote_data.html">
     Workflow 7: Retrieving data from remote archives
    </a>
   </li>
  </ul>
 </li>
</ul>

  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-data-sources-into-the-object-store">
   Loading data sources into the object store
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creating-a-model-scenario">
   Creating a model scenario
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparing-data-sources">
   Comparing data sources
  </a>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  <section id="workflow-3-comparing-observations-to-emissions">
<h1>Workflow 3: comparing observations to emissions<a class="headerlink" href="#workflow-3-comparing-observations-to-emissions" title="Permalink to this heading">#</a></h1>
<p>In addition to observation files, ancillary data can also be added to an openghg object store which can be used to perform analysis.</p>
<p>At the moment, the accepted files include:</p>
<ul class="simple">
<li><p>Footprints - regional outputs from an LPDM model (e.g. NAME)</p></li>
<li><p>Emissions/Flux - estimates of species emissions within a region</p></li>
<li><p><em>[+Boundary conditions - to be added+]</em></p></li>
<li><p>Global CTM output (e.g. GEOSChem)</p></li>
</ul>
<p>These inputs must adhere to an expected format and are expected to minimally contain a fixed set of inputs.</p>
<p><em>At the moment, the expected format for these files is created through standard methods from within the ACRG repository.</em></p>
<section id="loading-data-sources-into-the-object-store">
<h2>Loading data sources into the object store<a class="headerlink" href="#loading-data-sources-into-the-object-store" title="Permalink to this heading">#</a></h2>
<p>For this tutorial we will again set up a temporary object store to store our data.</p>
<p>See <a class="reference internal" href="1_Adding_observation_data.html"><span class="doc std std-doc">1_Adding_observation_data.ipynb</span></a> for more details and advice on how to create a more permanent object store. Once a permanent object store is set up, these steps would only need to be performed once. Any added data can then be retrieved using searches.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="n">tmp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENGHG_PATH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_dir</span><span class="o">.</span><span class="n">name</span>   <span class="c1"># temporary directory</span>
</pre></div>
</div>
</div>
</div>
<p>For this, we will add observation, footprint and flux data to the object store. This data relates to Tacolneston (TAC) site within the DECC network and the area around Europe (EUROPE domain).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openghg.client</span> <span class="kn">import</span> <span class="n">process_obs</span>

<span class="n">obs_file</span> <span class="o">=</span> <span class="s2">&quot;../data/DECC/tac.picarro.1minute.100m.201208.dat&quot;</span>

<span class="n">site</span><span class="o">=</span><span class="s2">&quot;tac&quot;</span>
<span class="n">network</span><span class="o">=</span><span class="s2">&quot;DECC&quot;</span>
<span class="n">height</span><span class="o">=</span><span class="s2">&quot;100m&quot;</span>
<span class="n">species</span><span class="o">=</span><span class="s2">&quot;ch4&quot;</span>

<span class="n">process_obs</span><span class="p">(</span><span class="n">files</span><span class="o">=</span><span class="n">obs_file</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;CRDS&quot;</span><span class="p">,</span> <span class="n">site</span><span class="o">=</span><span class="n">site</span><span class="p">,</span> <span class="n">network</span><span class="o">=</span><span class="n">network</span><span class="p">,</span> <span class="n">inlet</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openghg.client</span> <span class="kn">import</span> <span class="n">process_footprint</span>

<span class="n">fp_file_path</span> <span class="o">=</span> <span class="s2">&quot;../data/footprints/TAC-100magl_EUROPE_201208.nc&quot;</span>

<span class="n">site</span><span class="o">=</span><span class="s2">&quot;tac&quot;</span>
<span class="n">height</span><span class="o">=</span><span class="s2">&quot;100m&quot;</span>
<span class="n">domain</span><span class="o">=</span><span class="s2">&quot;EUROPE&quot;</span>
<span class="n">model</span><span class="o">=</span><span class="s2">&quot;NAME&quot;</span>

<span class="n">process_footprint</span><span class="p">(</span><span class="n">files</span><span class="o">=</span><span class="n">fp_file_path</span><span class="p">,</span> <span class="n">site</span><span class="o">=</span><span class="n">site</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openghg.util</span> <span class="kn">import</span> <span class="n">retrieve_example_data</span>

<span class="n">flux_data</span> <span class="o">=</span> <span class="n">retrieve_example_data</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;flux/ch4-ukghg-all_EUROPE_2012.tar.gz&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openghg.util</span> <span class="kn">import</span> <span class="n">retrieve_example_data</span>
<span class="kn">from</span> <span class="nn">openghg.client</span> <span class="kn">import</span> <span class="n">process_flux</span>

<span class="n">flux_data</span> <span class="o">=</span> <span class="n">retrieve_example_data</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;flux/ch4-ukghg-all_EUROPE_2012.tar.gz&quot;</span><span class="p">)</span>

<span class="n">site</span><span class="o">=</span><span class="s2">&quot;tac&quot;</span>
<span class="n">domain</span><span class="o">=</span><span class="s2">&quot;EUROPE&quot;</span>
<span class="n">date</span> <span class="o">=</span> <span class="s2">&quot;2012&quot;</span>

<span class="n">source_waste</span> <span class="o">=</span> <span class="s2">&quot;waste&quot;</span>
<span class="n">source_energyprod</span> <span class="o">=</span> <span class="s2">&quot;energyprod&quot;</span>

<span class="n">flux_data_waste</span> <span class="o">=</span> <span class="p">[</span><span class="n">filename</span> <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">flux_data</span> <span class="k">if</span> <span class="n">source_waste</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">flux_data_energyprod</span> <span class="o">=</span> <span class="p">[</span><span class="n">filename</span> <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">flux_data</span> <span class="k">if</span> <span class="n">source_energyprod</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">process_flux</span><span class="p">(</span><span class="n">files</span><span class="o">=</span><span class="n">flux_data_waste</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source_waste</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
<span class="n">process_flux</span><span class="p">(</span><span class="n">files</span><span class="o">=</span><span class="n">flux_data_energyprod</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source_energyprod</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="creating-a-model-scenario">
<h2>Creating a model scenario<a class="headerlink" href="#creating-a-model-scenario" title="Permalink to this heading">#</a></h2>
<p>With this ancillary data, we can start to make comparisons between model data, such as bottom-up inventories, and our observations. This analysis is based around a <code class="docutils literal notranslate"><span class="pre">ModelScenario</span></code> class which can be created to link together observation, footprint and emissions data.</p>
<p><em>Boundary conditions and other model data will be added soon</em></p>
<p>Above we loaded observation data from the Tacolneston site into the object store. We also added an associated footprint (sensitivity map) and anthropogenic emissions maps both for a domain defined over Europe.</p>
<p>To access and link this data we can set up our <code class="docutils literal notranslate"><span class="pre">ModelScenario</span></code> instance using a similiar set of keywords. In this case we have also limited ourselves to a date range:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openghg.analyse</span> <span class="kn">import</span> <span class="n">ModelScenario</span>

<span class="n">start_date</span> <span class="o">=</span> <span class="s2">&quot;2012-08-01&quot;</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="s2">&quot;2012-09-01&quot;</span>

<span class="n">scenario</span> <span class="o">=</span> <span class="n">ModelScenario</span><span class="p">(</span><span class="n">site</span><span class="o">=</span><span class="n">site</span><span class="p">,</span>
                         <span class="n">inlet</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                         <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
                         <span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span>
                         <span class="n">source</span><span class="o">=</span><span class="n">source_waste</span><span class="p">,</span>
                         <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                         <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Using these keywords, this will search the object store and attempt to collect and attach observation, footprint and flux data. This collected data will be attached to your created <code class="docutils literal notranslate"><span class="pre">ModelScenario</span></code>. For the observations this will be stored as the <code class="docutils literal notranslate"><span class="pre">ModelScenario.obs</span></code> attribute. This will be an <code class="docutils literal notranslate"><span class="pre">ObsData</span></code> object which contains metadata and data for your observations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scenario</span><span class="o">.</span><span class="n">obs</span>
</pre></div>
</div>
</div>
</div>
<p>To access the undelying xarray Dataset containing the observation data use <code class="docutils literal notranslate"><span class="pre">ModelScenario.obs.data</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ModelScenario.footprint</span></code> attribute contains the linked FootprintData (again, use <code class="docutils literal notranslate"><span class="pre">.data</span></code> to extract xarray Dataset):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scenario</span><span class="o">.</span><span class="n">footprint</span>
</pre></div>
</div>
</div>
</div>
<p>And the <code class="docutils literal notranslate"><span class="pre">ModelScenario.fluxes</span></code> attribute can be used to access the FluxData. Note that for <code class="docutils literal notranslate"><span class="pre">ModelScenario.fluxes</span></code> this can contain multiple flux sources and so this is stored as a dictionary linked to the source name:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scenario</span><span class="o">.</span><span class="n">fluxes</span>
</pre></div>
</div>
</div>
</div>
<p>An interactive plot for the linked observation data can be plotted using the <code class="docutils literal notranslate"><span class="pre">ModelScenario.plot_timeseries()</span></code> method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scenario</span><span class="o">.</span><span class="n">plot_timeseries</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>You can also set up your own searches and add this data directly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openghg.retrieve</span> <span class="kn">import</span> <span class="n">get_obs_surface</span><span class="p">,</span> <span class="n">get_footprint</span><span class="p">,</span> <span class="n">get_flux</span>

<span class="c1"># Extract obs results from object store</span>
<span class="n">obs_results</span> <span class="o">=</span> <span class="n">get_obs_surface</span><span class="p">(</span><span class="n">site</span><span class="o">=</span><span class="n">site</span><span class="p">,</span>
                              <span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span>
                              <span class="n">inlet</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                              <span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;2012-08-01&quot;</span><span class="p">,</span>
                              <span class="n">end_date</span><span class="o">=</span><span class="s2">&quot;2012-09-01&quot;</span><span class="p">)</span>

<span class="c1"># Extract footprint results from object store</span>
<span class="n">footprint_results</span> <span class="o">=</span> <span class="n">get_footprint</span><span class="p">(</span><span class="n">site</span><span class="o">=</span><span class="n">site</span><span class="p">,</span>
                                  <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
                                  <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                                  <span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;2012-08-01&quot;</span><span class="p">,</span>
                                  <span class="n">end_date</span><span class="o">=</span><span class="s2">&quot;2012-09-01&quot;</span><span class="p">)</span>

<span class="c1"># Extract flux results from object store</span>
<span class="n">flux_results</span> <span class="o">=</span> <span class="n">get_flux</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span>
                        <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
                        <span class="n">source</span><span class="o">=</span><span class="n">source_waste</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scenario_direct</span> <span class="o">=</span> <span class="n">ModelScenario</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="n">obs_results</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">footprint_results</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="n">flux_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><em>You can create your own input objects directly and add these in the same way. This allows you to bypass the object store for experimental examples. At the moment these inputs need to be <code class="docutils literal notranslate"><span class="pre">ObsData</span></code>, <code class="docutils literal notranslate"><span class="pre">FootprintData</span></code> or <code class="docutils literal notranslate"><span class="pre">FluxData</span></code> objects (can be created using classes from openghg.dataobjects) but simpler inputs will be made available</em>.</p>
<p>One benefit of this interface is to reduce searching the database if the same data needs to be used for multiple different scenarios.</p>
</section>
<section id="comparing-data-sources">
<h2>Comparing data sources<a class="headerlink" href="#comparing-data-sources" title="Permalink to this heading">#</a></h2>
<p>Once your <code class="docutils literal notranslate"><span class="pre">ModelScenario</span></code> has been created you can then start to use the linked data to compare outputs. For example we may want to calculate modelled observations at our site based on our linkec footprint and emissions data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">modelled_observations</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">calc_modelled_obs</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>This could then be plotted directlt using the xarray plotting methods:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">modelled_observations</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>  <span class="c1"># Can plot using xarray plotting methods</span>
</pre></div>
</div>
</div>
</div>
<p>To compare the these modelled observations to the ovbservations themselves, the <code class="docutils literal notranslate"><span class="pre">ModelScenario.plot_comparison()</span></code> method can be used:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scenario</span><span class="o">.</span><span class="n">plot_comparison</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ModelScenario.footprints_data_merge()</span></code> method can also be used to created a combined output, with all aligned data stored directly within an <code class="docutils literal notranslate"><span class="pre">xarray.Dataset</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">combined_dataset</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">footprints_data_merge</span><span class="p">()</span>
<span class="n">combined_dataset</span>
</pre></div>
</div>
</div>
</div>
<p>When the same calculation is being performed for multiple methods, the last calculation is cached to allow the outputs to be produced more efficiently. This can be disabled for large datasets by using <code class="docutils literal notranslate"><span class="pre">cache=False</span></code>.</p>
<p>For a <code class="docutils literal notranslate"><span class="pre">ModelScenario</span></code> object, different analyses can be performed on this linked data. For example if a daily average for the modelled observations was required, we could calculate this setting our <code class="docutils literal notranslate"><span class="pre">resample_to</span></code> input to <code class="docutils literal notranslate"><span class="pre">&quot;1D&quot;</span></code> (matching available pandas time aliases):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">modelled_observations_12H</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">calc_modelled_obs</span><span class="p">(</span><span class="n">resample_to</span><span class="o">=</span><span class="s2">&quot;1D&quot;</span><span class="p">)</span>
<span class="n">modelled_observations_12H</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>To allow comparisons with multiple fluxes inputs, more than one flux source can be linked to your <code class="docutils literal notranslate"><span class="pre">ModelScenario</span></code>. This can be either be done upon creation or can be added using the <code class="docutils literal notranslate"><span class="pre">add_flux()</span></code> method. When calculating modelled observations, these flux sources will be aligned in time and stacked to create a total output:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scenario</span><span class="o">.</span><span class="n">add_flux</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source_energyprod</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scenario</span><span class="o">.</span><span class="n">plot_comparison</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Output for individual sources can also be created by specifying the <code class="docutils literal notranslate"><span class="pre">sources</span></code> as an input:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Included recalculate option to ensure this is updated from cached data.</span>
<span class="n">modelled_obs_energyprod</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">calc_modelled_obs</span><span class="p">(</span><span class="n">sources</span><span class="o">=</span><span class="s2">&quot;energyprod&quot;</span><span class="p">,</span> <span class="n">recalculate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">modelled_obs_energyprod</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><em>Plotting functions to be added for 2D / 3D data</em></p>
<hr class="docutils" />
</section>
</section>


              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="2_Ranking_for_observations.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Workflow 2: handling overlapping observation data</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="4_Working_with_co2.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Workflow 4: Working with carbon dioxide</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2022 OpenGHG development team.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.1.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>